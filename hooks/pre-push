#!/bin/bash
# Pre-push hook: lint, type-check, and build before pushing
# Install: cp hooks/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push

set -e

echo "ğŸ” Running pre-push checks..."

# Ensure we're using bun
export PATH="$HOME/.bun/bin:$PATH"

# 1. Type check
echo "ğŸ“ Type checking..."
bun run check || {
  echo "âŒ Type check failed. Fix errors before pushing."
  exit 1
}

# 2. Build
echo "ğŸ—ï¸  Building..."
bun run build || {
  echo "âŒ Build failed. Fix errors before pushing."
  exit 1
}

# 3. Syntax check gate scripts
for gate in gates/*.gate.sh; do
  if [ -f "$gate" ]; then
    echo "ğŸš¦ Checking $gate syntax..."
    bash -n "$gate" || {
      echo "âŒ Gate script $gate has syntax errors."
      exit 1
    }
  fi
done

echo "âœ… All pre-push checks passed!"
